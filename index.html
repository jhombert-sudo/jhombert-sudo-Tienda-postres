<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tienda de Postres</title>
  <meta name="description" content="Tienda de postres para GitHub Pages. B√∫squeda, filtros y carrito con WhatsApp y env√≠o por distancia." />
  <style>
    :root{
      --bg:#0b1220; --card:#121a2b; --muted:#a7b2c7;
      --accent:#7dd3fc; --accent-2:#38bdf8; --white:#f8fafc;
      --ok:#22c55e; --border:rgba(125,211,252,.18);
    }
    *{box-sizing:border-box}
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      background:linear-gradient(180deg,#0b1220 0%,#0e1627 60%,#0b1220 100%); color:var(--white); min-height:100svh}
    header{ position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.2) blur(8px);
      background:rgba(11,18,32,.7); border-bottom:1px solid var(--border)}
    .wrap{max-width:1100px; margin:auto; padding:18px}
    .brand{display:flex; align-items:center; gap:12px}
    .logo{width:40px; height:40px; border-radius:12px; display:grid; place-items:center;
      background:radial-gradient(120px 80px at 30% 20%,#38bdf8,transparent),
                 radial-gradient(120px 80px at 70% 80%,#7dd3fc,transparent);
      box-shadow:0 6px 30px rgba(125,211,252,.25)}
    h1{font-size:clamp(20px,3vw,28px); margin:0}

    .toolbar{display:grid; grid-template-columns:1fr auto auto auto; gap:12px; margin-top:14px}
    .row{display:flex; gap:8px; flex-wrap:wrap}
    .search{display:flex; align-items:center; gap:10px; background:var(--card); border:1px solid var(--border); border-radius:14px; padding:10px 12px}
    .search input{flex:1; background:transparent; border:0; outline:0; color:var(--white); font-size:16px}
    .btn, .select{border:1px solid rgba(125,211,252,.25); background:var(--card); color:var(--white); padding:10px 12px; border-radius:12px; cursor:pointer}
    .btn:hover, .select:hover{border-color:var(--accent)}
    .btn.active{background:linear-gradient(135deg,rgba(56,189,248,.18),rgba(125,211,252,.08)); border-color:var(--accent-2)}
    select.select{appearance:none}

    main{padding:26px 18px}
    .grid{--min:240px; display:grid; grid-template-columns:repeat(auto-fill,minmax(var(--min),1fr)); gap:16px; max-width:1100px; margin:auto}
    .card{background:var(--card); border:1px solid rgba(125,211,252,.12); border-radius:16px; overflow:hidden; display:flex; flex-direction:column; box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .card picture{display:block; aspect-ratio:16/11; background:#0b1220; overflow:hidden}
    .card img{width:100%; height:100%; object-fit:cover; display:block; transition:transform .5s ease}
    .card:hover img{transform:scale(1.06)}
    .card .body{padding:14px}
    .title{font-size:18px; margin:0 0 6px}
    .meta{display:flex; justify-content:space-between; align-items:center; color:var(--muted); font-size:14px}
    .price{color:var(--accent-2); font-weight:700}
    .tags{margin-top:8px; display:flex; gap:6px; flex-wrap:wrap}
    .chip{font-size:12px; padding:4px 8px; border:1px solid rgba(125,211,252,.25); border-radius:999px; color:var(--muted)}
    .actions{display:flex; gap:8px; margin-top:12px}
    .actions .btn{flex:1}
    .actions .btn.add{background:linear-gradient(135deg,rgba(56,189,248,.22),rgba(125,211,252,.1)); border-color:var(--accent-2)}
    .actions .btn.add:hover{transform:translateY(-1px)}

    .cart{position:fixed; right:18px; bottom:18px; display:flex; gap:10px; align-items:center; background:linear-gradient(135deg,rgba(56,189,248,.22),rgba(125,211,252,.1)); border:1px solid rgba(125,211,252,.4); padding:10px 14px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .cart small{color:var(--muted)}
    .cart .count{font-weight:700; color:var(--accent-2)}
    .cart .total{font-weight:700}
    .wa{background:transparent; border:1px solid var(--ok); color:var(--white); padding:10px 12px; border-radius:12px; cursor:pointer}
    .wa:hover{background:rgba(34,197,94,.12)}

    footer{border-top:1px solid var(--border); margin-top:30px}
    footer .wrap{display:flex; flex-direction:column; gap:8px}
    footer a{color:var(--accent)}
    .empty{grid-column:1/-1; text-align:center; color:var(--muted); padding:30px; border:1px dashed rgba(125,211,252,.25); border-radius:16px}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <div class="logo" aria-hidden>üç∞</div>
        <h1>Postres Deliciosos</h1>
      </div>

      <div class="toolbar">
        <label class="search" aria-label="Buscar postres">
          üîé <input id="q" type="search" placeholder="Buscar (ej.: cheesecake, torta, pastel)‚Ä¶" />
        </label>

        <!-- Filtros (sin Helados) -->
        <div class="row" role="group" aria-label="Filtros de categor√≠a">
          <button class="btn active" data-cat="all">Todos</button>
          <button class="btn" data-cat="tortas">Tortas</button>
          <button class="btn" data-cat="pasteleria">Pasteler√≠a</button>
        </div>

        <!-- Selector de zona + bot√≥n autom√°tico -->
        <select id="zone" class="select" aria-label="Zona de env√≠o">
          <option value="retira">Retiro en local (sin costo)</option>
          <option value="z1">Env√≠o 0‚Äì3 km</option>
          <option value="z2">Env√≠o 3‚Äì6 km</option>
          <option value="z3">Env√≠o 6‚Äì10 km</option>
        </select>
        <button id="autoZone" class="btn" title="Calcular seg√∫n tu ubicaci√≥n">Calcular por ubicaci√≥n</button>
      </div>
    </div>
  </header>

  <main>
    <section class="grid" id="grid" aria-live="polite"></section>
  </main>

  <div class="cart" aria-live="polite">
    <small><span class="count" id="cartCount">0</span> √≠tems</small>
    <small>Subtotal: <span id="subTotal">$0</span> ¬∑ Env√≠o: <span id="shipFee">$0</span></small>
    <span class="total" id="grandTotal">$0</span>
    <button class="wa" id="waBtn">Enviar pedido por WhatsApp</button>
  </div>

  <footer>
    <div class="wrap">
      <small>Im√°genes desde Unsplash. Cambi√° las URLs cuando tengas tus propias fotos.</small>
      <small>Hecho para GitHub Pages: sub√≠ este <code>index.html</code> y activ√° Pages. üíô</small>
    </div>
  </footer>

  <script>
  // ‚Äî‚Äî‚Äî Configuraci√≥n ‚Äî‚Äî‚Äî
  const CONFIG = {
    // Coordenadas del LOCAL (tuyas)
    STORE_LAT: -34.6335848,
    STORE_LNG: -58.5979308,
    PHONE: '5491154815519',   // 54 + 9 + √°rea (sin 0) + l√≠nea (sin 15). SIN '+'
    CURRENCY: 'ARS',
    ZONES: {
      retira: {name:'Retiro en local', fee:0},
      z1: {name:'0‚Äì3 km', fee:1500},
      z2: {name:'3‚Äì6 km', fee:2500},
      z3: {name:'6‚Äì10 km', fee:3500}
    }
  };

  // ‚Äî‚Äî‚Äî Cat√°logo (sin helados) ‚Äî‚Äî‚Äî
  const CATALOG = [
    { id:"ck1", nombre:"Cheesecake de chocolate", precio: 6200, cat:"tortas",   img:"https://source.unsplash.com/DOWsiEekKIA" },
    { id:"ck4", nombre:"Cheesecake de cereza",    precio: 5900, cat:"tortas",   img:"https://source.unsplash.com/YLMjArY4048" },
    { id:"ck7", nombre:"Cheesecake rosa",         precio: 6000, cat:"tortas",   img:"https://source.unsplash.com/FDYbS43jUrU" },
    { id:"ck8", nombre:"Cheesecake cl√°sico",      precio: 5700, cat:"tortas",   img:"https://source.unsplash.com/vx4UkYTzl0w" },
    { id:"ck5", nombre:"Pastelitos azucarados",   precio: 2400, cat:"pasteleria", img:"https://source.unsplash.com/R3RwPzTakCU" }
  ];

  const state = { q:"", cat:"all", cart:new Map(), zone:"retira" };

  const $grid = document.getElementById('grid');
  const $q = document.getElementById('q');
  const $waBtn = document.getElementById('waBtn');
  const $cartCount = document.getElementById('cartCount');
  const $subTotal = document.getElementById('subTotal');
  const $shipFee = document.getElementById('shipFee');
  const $grandTotal = document.getElementById('grandTotal');
  const $zone = document.getElementById('zone');
  const $autoZone = document.getElementById('autoZone');

  // ‚Äî‚Äî‚Äî Render inicial ‚Äî‚Äî‚Äî
  render(); updateTotals();

  // ‚Äî‚Äî‚Äî Eventos ‚Äî‚Äî‚Äî
  document.querySelectorAll('[data-cat]').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('[data-cat]').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      state.cat = btn.dataset.cat;
      render();
    });
  });

  $q.addEventListener('input', () => { state.q = $q.value.trim().toLowerCase(); render(); });

  $zone.addEventListener('change', () => { state.zone = $zone.value; updateTotals(); });

  $autoZone.addEventListener('click', async () => {
    try{
      const pos = await getCurrentPosition({enableHighAccuracy:true, timeout:10000});
      const km = haversineKm(CONFIG.STORE_LAT, CONFIG.STORE_LNG, pos.coords.latitude, pos.coords.longitude);
      applyZoneByKm(km);
      alert(`Est√°s a ${km.toFixed(1)} km del local. Zona aplicada: ${CONFIG.ZONES[state.zone].name}.`);
    }catch(e){
      const txt = prompt('No pudimos obtener tu ubicaci√≥n autom√°ticamente. Ingres√° tus coordenadas como "lat,lon" (ej: -34.60,-58.38):');
      if(txt){
        const [lat,lon] = parseCoords(txt);
        if(Number.isFinite(lat) && Number.isFinite(lon)){
          const km = haversineKm(CONFIG.STORE_LAT, CONFIG.STORE_LNG, lat, lon);
          applyZoneByKm(km);
          alert(`Est√°s a ${km.toFixed(1)} km del local. Zona aplicada: ${CONFIG.ZONES[state.zone].name}.`);
        }else{
          alert('Formato inv√°lido. Us√°: -34.60,-58.38');
        }
      }
    }
  });

  $waBtn.addEventListener('click', () => {
    if(!state.cart.size){
      alert('Tu carrito est√° vac√≠o. Eleg√≠ al menos un postre.');
      return;
    }
    const items = [...state.cart.values()].map(i => `‚Ä¢ ${i.nombre} x${i.qty} ‚Äî ${money(i.precio*i.qty)}`);
    const {subtotal, fee, total} = calcTotals();
    const zone = CONFIG.ZONES[state.zone]?.name || 'Retiro en local';
    const msg =
      `Hola, quiero hacer este pedido:%0A%0A${items.join('%0A')}`+
      `%0A%0AEnv√≠o: ${zone} ‚Äî ${money(fee)}`+
      `%0ASubtotal: ${money(subtotal)}`+
      `%0ATotal: ${money(total)}`;
    window.open(`https://wa.me/${CONFIG.PHONE}?text=${msg}`,'_blank');
  });

  // ‚Äî‚Äî‚Äî Funciones ‚Äî‚Äî‚Äî
  function render(){
    const list = CATALOG
      .filter(p => state.cat==='all' ? true : p.cat===state.cat)
      .filter(p => state.q ? p.nombre.toLowerCase().includes(state.q) : true);

    $grid.innerHTML = '';
    if(!list.length){
      $grid.innerHTML = `<div class="empty">No encontramos nada con esos filtros. Prob√° borrar la b√∫squeda o cambiar la categor√≠a üçÆ</div>`;
      return;
    }
    list.forEach(p => $grid.appendChild(card(p)));
  }

  function card(p){
    const el = document.createElement('article');
    el.className = 'card';
    el.innerHTML = `
      <picture><img loading="lazy" alt="${escapeHtml(p.nombre)}" src="${p.img}"/></picture>
      <div class="body">
        <h3 class="title">${escapeHtml(p.nombre)}</h3>
        <div class="meta">
          <span class="price">${money(p.precio)}</span>
          <span>${prettyCat(p.cat)}</span>
        </div>
        <div class="tags">
          <span class="chip">Sin TACC*</span>
          <span class="chip">Artesanal</span>
        </div>
        <div class="actions">
          <button class="btn add" data-id="${p.id}">Agregar</button>
          <button class="btn" data-id="${p.id}" data-quick>+1</button>
        </div>
      </div>`;

    el.querySelectorAll('button').forEach(b=>{
      b.addEventListener('click', (ev)=>{
        const id = ev.currentTarget.dataset.id;
        addToCart(id, ev.currentTarget.hasAttribute('data-quick'));
      });
    });
    return el;
  }

  function addToCart(id, quick){
    const prod = CATALOG.find(x=>x.id===id);
    if(!prod) return;
    const cur = state.cart.get(id) || { ...prod, qty:0 };
    cur.qty += 1;
    state.cart.set(id, cur);
    $cartCount.textContent = [...state.cart.values()].reduce((a,i)=>a+i.qty,0);
    if(!quick) console.log(`${prod.nombre} sumado al carrito. üç≠`);
    updateTotals();
  }

  function prettyCat(c){ return c==='tortas' ? 'Torta' : 'Pasteler√≠a'; }

  function money(n){
    return new Intl.NumberFormat('es-AR',{style:'currency',currency:CONFIG.CURRENCY, maximumFractionDigits:0}).format(n);
  }

  function calcTotals(){
    const subtotal = [...state.cart.values()].reduce((a,i)=>a+i.precio*i.qty,0);
    const fee = CONFIG.ZONES[state.zone]?.fee || 0;
    const total = subtotal + fee;
    return {subtotal, fee, total};
  }

  function updateTotals(){
    const {subtotal, fee, total} = calcTotals();
    $subTotal.textContent = money(subtotal);
    $shipFee.textContent = money(fee);
    $grandTotal.textContent = money(total);
  }

  // Haversine: distancia en km entre dos coordenadas
  function haversineKm(lat1, lon1, lat2, lon2){
    const R = 6371; // km
    const toRad = d => d * Math.PI / 180;
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
    return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  }

  function applyZoneByKm(km){
    if(km < 0.2){ state.zone = 'retira'; }      // mismo sitio / muy cerca
    else if(km <= 3){ state.zone = 'z1'; }
    else if(km <= 6){ state.zone = 'z2'; }
    else { state.zone = 'z3'; }                  // >6‚Äì10 km (ajustable)
    $zone.value = state.zone;
    updateTotals();
  }

  function parseCoords(text){
    const parts = (text||'').split(',').map(s=>parseFloat(s.trim()));
    return [parts[0], parts[1]];
  }

  // Promesa para geolocalizaci√≥n
  function getCurrentPosition(opts={}){
    return new Promise((res, rej) => {
      if(!('geolocation' in navigator)) return rej(new Error('Geolocalizaci√≥n no disponible'));
      navigator.geolocation.getCurrentPosition(res, rej, opts);
    });
  }

  function escapeHtml(s){
    return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;', "'":'&#39;'}[m]));
  }
  </script>
</body>
</html>
